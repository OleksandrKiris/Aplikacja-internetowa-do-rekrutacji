{% extends 'home/base.html' %}

{% block content %}
<section class="container my-5">
    <h1 class="h4 text-primary text-center mb-4">Zarejestrowane aplikacje</h1>
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm align-middle">
            <thead class="bg-primary text-white">
                <tr>
                    <th>Imię i Nazwisko</th>
                    <th>Email</th>
                    <th>Telefon</th>
                    <th>Lokalizacja</th>
                    <th>Biografia</th>
                    <th>Umiejętności</th>
                    <th>List motywacyjny</th>
                    <th>Status</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody>
                {% for application in applications %}
                    <tr>
                        {% if application.applicant.candidate_profile %}
                            <td>{{ application.applicant.candidate_profile.first_name }} {{ application.applicant.candidate_profile.last_name }}</td>
                            <td>{{ application.applicant.email|truncatechars:20 }}</td>
                            <td>{{ application.applicant.candidate_profile.phone_number|truncatechars:15 }}</td>
                            <td>{{ application.applicant.candidate_profile.location|truncatechars:15 }}</td>
                            <td>{{ application.applicant.candidate_profile.bio|truncatewords:5 }}</td>
                            <td>{{ application.applicant.candidate_profile.skills|truncatewords:5 }}</td>
                            <td>{{ application.cover_letter|truncatewords:5 }}</td>
                            <td>
                                <form method="POST" action="{% url 'jobs:update_application_status' application.id %}">
                                    {% csrf_token %}
                                    <select name="status" class="form-select form-select-sm">
                                        {% for value, name in application.ApplicationStatus.choices %}
                                            <option value="{{ value }}" {% if application.status == value %}selected{% endif %}>{{ name }}</option>
                                        {% endfor %}
                                    </select>
                                    <button type="submit" class="btn btn-secondary btn-sm mt-2">Zmień status</button>
                                </form>
                            </td>
                            <td>
                                <a href="#" class="btn btn-primary btn-sm mt-2">Wyślij wiadomość</a>
                            </td>
                        {% else %}
                            <td colspan="9" class="text-center">Brak danych profilu dla tego kandydata.</td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="9" class="text-center text-muted">Brak zarejestrowanych aplikacji.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
